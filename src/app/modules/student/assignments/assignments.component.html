<div class="assignments-container">
  <!-- Header -->
  <div class="assignments-header-bar">
    <div class="header-content">
      <h2>Assignments</h2>
      <div class="header-actions">
        <span class="welcome-user">{{ getCurrentUserName() }}</span>
        <button mat-raised-button color="warn" (click)="logout()">
          <mat-icon>logout</mat-icon>
          Switch User
        </button>
      </div>
    </div>
  </div>

  <div class="assignments-content">
    <div class="assignments-header">
      <h1>My Assignments</h1>
      <p>Submit your assignments and track your progress</p>
    </div>

    <!-- Tabs -->
    <mat-tab-group [(selectedIndex)]="selectedTab" class="assignments-tabs">
      <mat-tab label="Pending">
        <div class="tab-content">
          <div *ngIf="getFilteredAssignments().length === 0" class="empty-state">
            <mat-icon class="empty-icon">assignment_turned_in</mat-icon>
            <h3>No Pending Assignments</h3>
            <p>Great! You're all caught up with your assignments.</p>
          </div>
          
          <div class="assignments-grid" *ngIf="getFilteredAssignments().length > 0">
            <mat-card *ngFor="let assignment of getFilteredAssignments()" 
                     class="assignment-card"
                     [class.overdue]="isOverdue(assignment)">
              <mat-card-header>
                <mat-card-title>{{ assignment.title }}</mat-card-title>
                <mat-card-subtitle>
                  {{ assignment.subject }} • {{ assignment.maxMarks }} marks
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <p class="assignment-description">{{ assignment.description }}</p>
                
                <div class="assignment-meta">
                  <div class="due-date" [class.overdue-text]="isOverdue(assignment)">
                    <mat-icon>schedule</mat-icon>
                    <span *ngIf="!isOverdue(assignment)">
                      Due in {{ getDaysRemaining(assignment.dueDate) }} days
                    </span>
                    <span *ngIf="isOverdue(assignment)" class="overdue-text">
                      Overdue by {{ Math.abs(getDaysRemaining(assignment.dueDate)) }} days
                    </span>
                  </div>
                  
                  <div class="file-requirements">
                    <mat-icon>attach_file</mat-icon>
                    <span>Max {{ assignment.maxFileSize }}MB • {{ assignment.allowedFileTypes.join(', ') }}</span>
                  </div>
                </div>

                <div class="file-upload-section">
                  <input type="file" 
                         [id]="'file-' + assignment.id"
                        #fileInput
                         (change)="onFileSelected($event, assignment)"
                         [accept]="assignment.allowedFileTypes.join(',')"
                         multiple
                         style="display: none;">
                  
                  <button mat-stroked-button 
                          (click)="fileInput.click()">
                    <mat-icon>cloud_upload</mat-icon>
                    Choose Files
                  </button>
                  
                  <div *ngIf="selectedFiles.length > 0" class="selected-files">
                    <h4>Selected Files:</h4>
                    <div *ngFor="let file of selectedFiles" class="file-item">
                      <mat-icon>description</mat-icon>
                      <span>{{ file.name }}</span>
                      <small>({{ formatFileSize(file.size) }})</small>
                    </div>
                  </div>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button mat-raised-button 
                        color="primary" 
                        (click)="submitAssignment(assignment)"
                        [disabled]="selectedFiles.length === 0">
                  <mat-icon>send</mat-icon>
                  Submit Assignment
                </button>
                
                <button mat-button (click)="requestExtension(assignment)">
                  <mat-icon>access_time</mat-icon>
                  Request Extension
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Submitted">
        <div class="tab-content">
          <div *ngIf="getFilteredAssignments().length === 0" class="empty-state">
            <mat-icon class="empty-icon">assignment</mat-icon>
            <h3>No Submitted Assignments</h3>
            <p>Your submitted assignments will appear here.</p>
          </div>
          
          <div class="assignments-grid" *ngIf="getFilteredAssignments().length > 0">
            <mat-card *ngFor="let assignment of getFilteredAssignments()" class="assignment-card submitted-card">
              <mat-card-header>
                <mat-card-title>{{ assignment.title }}</mat-card-title>
                <mat-card-subtitle>
                  {{ assignment.subject }} • Submitted {{ assignment.submittedAt | date:'medium' }}
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <p class="assignment-description">{{ assignment.description }}</p>
                
                <div class="submission-info">
                  <div class="info-item">
                    <mat-icon>check_circle</mat-icon>
                    <span>Submitted on time</span>
                  </div>
                  
                  <div class="info-item">
                    <mat-icon>attach_file</mat-icon>
                    <span>{{ assignment.submittedFiles?.length || 0 }} files submitted</span>
                  </div>
                </div>

                <mat-chip [style.background-color]="getStatusColor(assignment.status)" class="status-chip">
                  <mat-icon>hourglass_empty</mat-icon>
                  Awaiting Grading
                </mat-chip>
              </mat-card-content>

              <mat-card-actions>
                <button mat-button (click)="downloadSubmission(assignment)">
                  <mat-icon>download</mat-icon>
                  Download Submission
                </button>
                
                <button mat-button 
                        (click)="resubmitAssignment(assignment)"
                        [disabled]="!assignment.allowResubmission"
                        color="accent">
                  <mat-icon>refresh</mat-icon>
                  Resubmit
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Graded">
        <div class="tab-content">
          <div *ngIf="getFilteredAssignments().length === 0" class="empty-state">
            <mat-icon class="empty-icon">grade</mat-icon>
            <h3>No Graded Assignments</h3>
            <p>Your graded assignments will appear here.</p>
          </div>
          
          <div class="assignments-grid" *ngIf="getFilteredAssignments().length > 0">
            <mat-card *ngFor="let assignment of getFilteredAssignments()" class="assignment-card graded-card">
              <mat-card-header>
                <mat-card-title>{{ assignment.title }}</mat-card-title>
                <mat-card-subtitle>
                  {{ assignment.subject }} • Graded
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <p class="assignment-description">{{ assignment.description }}</p>
                
                <div class="grade-section">
                  <div class="grade-display">
                    <div class="grade-score">{{ assignment.grade }}/{{ assignment.maxMarks }}</div>
                    <div class="grade-percentage">{{ ((assignment.grade! / assignment.maxMarks) * 100).toFixed(1) }}%</div>
                  </div>
                  
                  <div class="grade-progress">
                    <mat-progress-bar 
                      [value]="(assignment.grade! / assignment.maxMarks) * 100"
                      mode="determinate"
                      [color]="(assignment.grade! / assignment.maxMarks) >= 0.8 ? 'primary' : 
                               (assignment.grade! / assignment.maxMarks) >= 0.6 ? 'accent' : 'warn'">
                    </mat-progress-bar>
                  </div>
                </div>

                <div class="feedback-section" *ngIf="assignment.feedback">
                  <h4>Instructor Feedback:</h4>
                  <p class="feedback-text">{{ assignment.feedback }}</p>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button mat-button (click)="downloadSubmission(assignment)">
                  <mat-icon>download</mat-icon>
                  Download Submission
                </button>
                
                <button mat-button (click)="viewFeedback(assignment)">
                  <mat-icon>feedback</mat-icon>
                  View Detailed Feedback
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>